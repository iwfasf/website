_m({请先登录哦:'Please sign in first.',发表失败:'Failed to send.'}),document.head.innerHTML+="<svg version='1.1' xmlns='http://www.w3.org/2000/svg' style='display:none'><symbol id='-list' viewBox='0 0 32 32'><rect width='19' height='3' x='10' y='6.5' rx='1.5' ry='1.5'/><circle cx='5' cy='8' r='2'/><circle cx='5' cy='16' r='2'/><circle cx='5' cy='24' r='2'/><rect width='19' height='3' x='10' y='14.5' rx='1.5' ry='1.5'/><rect width='19' height='3' x='10' y='22.5' rx='1.5' ry='1.5'/></symbol><symbol id='-table' viewBox='0 0 32 32'><rect width='12' height='16' x='3' y='3' rx='2' ry='2'/><rect width='12' height='8' x='17' y='3' rx='2' ry='2'/><rect width='12' height='8' x='3' y='21' rx='2' ry='2'/><rect width='12' height='16' x='17' y='13' rx='2' ry='2'/></symbol></svg>",FASF.DB.init(),FASF.DB.Query('FASF'+data.year).ascending('s').find().then(e=>{const t=FASF.Time;let i=Ele('div','box page');i.innerHTML=`<h2>FASF ${data.year} ${_t('时间表')}</h2>`,i.style.minWidth='960px',c$('con')[1].append(i);let l=Ele('div'),a=Ele('div');a.style.whiteSpace='nowrap',i.append(l,a);let s=Ele('div','st-list').icon('list'),n=Ele('div','st-table').icon('table');s.onclick=()=>{l.show(),s.addCls('on'),a.hide(),n.rmCls('on')},n.onclick=()=>{l.hide(),s.rmCls('on'),a.show(),n.addCls('on')},i.firstChild.append(s,n),s.click();const d={'Solo Run':'s0','Special Event':'s1','Blind Race':'s2','Standard Race':'s3','Q&A':'s4'};let r=new Date(0),c=0,h=null,p=null,o=1440,g=0;e.forEach(e=>{let t=e.get('s'),i=60*t.getHours()+t.getMinutes()+t.getSeconds()/60;i<o&&(o=i)}),o-=5,e.forEach(e=>{let i=e.get('s');i.getDate()!==r.getDate()&&(c++,r=new Date(t.fDate(i)+' 00:00:00'),h=Ele('div','sch'),h.innerHTML=`<div class='sch-day'>Day ${c}</div><div class='sch-date'>${t.fDate(i)} ${t.week[i.getDay()]}</div>`,l.append(h),p=Ele('div','table-day'),p.innerHTML=`<h5>Day ${c}<p>${i.getMonth()+1}.${i.getDate()} ${t.week[i.getDay()]}</p></h5>`,a.append(p),p.onwheel=e=>{let t=y-e.deltaY;t>=1e3&&(y=t,css(v,{height:t+'px'})),e.preventDefault()});let s=Ele('div','sch-r'),n=Ele('div','table-run '+(d[e.get('t')||'Solo Run']||'s5')),f=`<div class='sch-time'>${t.fTime(i)}</div><div style='display:inline-block;vertical-align:middle;width:240px'>`,x=`<div class='table-time'>${t.fTime(i)}<span> - ${t.fMin(e.get('e'))}</span></div>`;e.get('g').forEach((e,t)=>{t&&(f+=', ');let i=e.lastIndexOf('=');if(-1===i)f+=`<a>${e}</a>`,x+=`<a class='table-game'>${e}</a>`;else{let t=e.slice(i+1);'h'!==t[0]&&(t='https://delicious-fruit.com/ratings/game_details.php?id='+t),f+=`<a href='${t}' target='_blank'>${e.slice(0,i)}</a>`,x+=`<a class='table-game' href='${t}' target='_blank'>${e.slice(0,i)}</a>`}}),f+=`</div><span style='width:64px;white-space:nowrap'>${t.fMin(e.get('e'))}</span><span style='width:74px'>${e.get('c')||'Any%'}</span><span style='width:74px'>${e.get('t')||'Solo Run'}</span><div style='display:inline-block;margin-left:16px;vertical-align:middle;width:320px'>`,x+=`<div style='margin:8px;white-space:pre-line'>${e.get('c')||'Any%'} by `,e.get('r').forEach((e,t)=>{t&&(f+=', ');let i,l=e.lastIndexOf('>');-1===l?(l=e.lastIndexOf('/'),-1===l?(l=e.lastIndexOf(':'),-1!==l&&(i='https://www.twitch.tv/'+e.slice(l+1))):i='https://space.bilibili.com'+e.slice(l)):i=e.slice(l+1),i?(i=`<a href='${i}' target='_blank'>${e.slice(0,l)}</a>`,f+=i,x+=i):(i=`<a>${e}</a>`,f+=i,x+=i)}),s.innerHTML=f+'</div>',h.append(s);let w=(i-r)/6e4-o,u=e.get('e');n.top=w,n.height=u,w+u>g&&(g=w+u),n.innerHTML=x+'</div>',p.append(n)}),h=Ele('div','sch'),h.innerHTML="<div class='sch-day'>End</div>",l.append(h);let v=c$('table-day'),y=2e3;css(v,{width:`calc(${100/c}% - 10px)`,height:'2000px'});let f=c$('table-run');for(let e=f.length;e--;)css(f[e],{top:f[e].top/g*100+'%',height:f[e].height/g*100+'%'})});const G=e=>{let t=Ele('div','review'),i=Ele('div').text(e.get('user').getUsername()),l=e.createdAt;return i.append(Ele('div','rv-time').text(FASF.Time.fDate(l)+' '+FASF.Time.fTime(l))),t.append(i,Ele('p').text(e.get('word'))),t};i$('review').onclick=function(){if(this.on)return;if(!FASF.user)return alert(_t('请先登录哦'));let e=this.prev().value.trim();if(!e)return;this.on=!0,this.r=function(){this.on=!1,css(this,{background:'',pointerEvents:''})};let t=FASF.DB.Object('Review');t.set('user',FASF.user),t.set('word',e),t.set('index',data.year),t.save().then(e=>{let t=G(e),i=i$('rv-box').lastChild.prev(),l=i.prev();l.firstChild?(i.firstChild.before(t),l.firstChild.before(t.cloneNode(1))):(i.append(t),l.append(t.cloneNode(1))),this.r(),this.prev().value=''},e=>{alert(_t('发表失败')),this.r()}),css(this,{background:'#bcd',pointerEvents:'none'})},FASF.DB.Query('Review').equalTo('index',data.year).include('user.username').descending('createdAt').find().then(e=>{if(0===e.length)return;let t=i$('rv-box').lastChild,i=t.prev(),l=i.prev(),a=0,s=0;e.forEach(e=>{let n=G(e);a<=s?(i.append(n),a+=n.offsetHeight+24):(t.append(n),s+=n.offsetHeight+24),l.append(n.cloneNode(1))})});