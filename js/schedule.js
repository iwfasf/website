_m({请先登录哦:'Please sign in first.',发表失败:'Failed to send.',前往直播间:'Watch live on',当前时区:'All times are converted to your timezone. Detected timezone'}),document.head.innerHTML+="<svg version='1.1' xmlns='http://www.w3.org/2000/svg' style='display:none'><symbol id='-list' viewBox='0 0 32 32'><rect width='19' height='3' x='10' y='6.5' rx='1.5' ry='1.5'/><circle cx='5' cy='8' r='2'/><circle cx='5' cy='16' r='2'/><circle cx='5' cy='24' r='2'/><rect width='19' height='3' x='10' y='14.5' rx='1.5' ry='1.5'/><rect width='19' height='3' x='10' y='22.5' rx='1.5' ry='1.5'/></symbol><symbol id='-table' viewBox='0 0 32 32'><rect width='12' height='16' x='3' y='3' rx='2' ry='2'/><rect width='12' height='8' x='17' y='3' rx='2' ry='2'/><rect width='12' height='8' x='3' y='21' rx='2' ry='2'/><rect width='12' height='16' x='17' y='13' rx='2' ry='2'/></symbol><symbol id=\"-bili\" viewBox=\"2 2 28 28\"><path d=\"M20 17.1l-6-3.4a1 1 0 0 0-1.5.8v7a1 1 0 0 0 1.5.8l6-3.4a1 1 0 0 0 0-1.8z\"/><path d=\"M25 8h-2l1.2-1.6a1.5 1.5 0 0 0-2.4-1.8L19.2 8h-6.4l-2.6-3.4a1.5 1.5 0 0 0-2.4 1.8L9 8H7a4 4 0 0 0-4 4v12a4 4 0 0 0 4 4h18a4 4 0 0 0 4-4V12a4 4 0 0 0-4-4zm1 16a1.1 1.1 0 0 1-1 1H7a1.1 1.1 0 0 1-1-1V12a1.1 1.1 0 0 1 1-1h18a1.1 1.1 0 0 1 1 1z\"/></symbol></svg>",FASF.DB.init(),FASF.DB.Query('Data').equalTo('year',data.year).first().then(e=>{let t=e=>{let t,i=e,a=e.indexOf('^'),l=1;return-1==a&&(a=e.indexOf('$'),l=0),a>0&&(i=e.slice(0,a),t=e.slice(a+1)),[i,t,l]};Object.assign(data,e.toJSON()),data.intro&&(i$('intro').innerHTML=`<h2>Fangame Summer Feast ${data.year}</h2>`+(_lang?data.intro:data.introE)),data.game.forEach((e,i)=>{let a=_lang?e.n:e.nE||e.n,l=Ele('div','box game select');l.innerHTML=`<h3>${a}</h3><p>${_lang?e.i:e.iE}</p>`,l.d=Ele('div','box game game-d'),l.d.innerHTML=`<h3>${a}</h3><p>${_t('作者')}</p>`,e.a.forEach(e=>{let[i,a,n]=t(e),s=Ele('a','btn-link');s.innerText=i,a&&(s.href=(n?'https://space.bilibili.com/':'https://twitter.com/')+a,s.target='_blank'),l.d.append(s)}),l.d.append(Ele('br'),Ele('span').text(_t('视频'))),e.v.forEach(e=>{let[i,a,n]=t(e),s=Ele('a','btn-link');s.innerText=_t(i),s.href='https://www.bilibili.com/video/'+a,s.target='_blank',l.d.append(s)}),l.d.append(Ele('br'),Ele('span').text(_t('下载'))),e.d?e.d.forEach(e=>{let[i,a,n]=t(e),s=Ele('a','btn-link');s.innerText=i,s.href=a,s.target='_blank',l.d.append(s)}):l.d.lastChild.text(_t('下载暂无')),l.d.style.backgroundImage=l.style.backgroundImage=`url(//test1.jsdelivr.net/gh/iwfasf/website@ggcn3/${location.pathname.slice(1)}img/${i}.png)`,l.d.hide(),l.onclick=function(){this.d.show(),bg.show()},cons[2].append(l),doc.body.append(l.d)})}),window.RUNNER=new Set,FASF.DB.Query('Schedule').equalTo('y',data.year).ascending('s').find().then(e=>{const t=FASF.Time;let i=Ele('div','box page','sch');i.innerHTML=`<h2>FASF ${data.year} ${_t('时间表')}</h2>`,i.style.minWidth='960px',c$('con')[1].append(i);let a=(new Date).getTimezoneOffset()/-60,l=Ele('div');l.innerHTML=`<i style='margin-left:8px;font-size:14px;color:#456'>${_t('当前时区')}: GMT${a>0?'+'+a:a}</i>`,l.style.textAlign='center',i$('sch').firstChild.after(l);let n=Ele('p');n.innerHTML=`📺 ${_t('前往直播间')}-> <a href='https://live.bilibili.com/7310386' target='_blank'>https://live.bilibili.com/7310386</a>`,css(n,{textAlign:'center',fontSize:'20px',fontWeight:600,textIndent:0}),i$('sch').firstChild.after(n);let s=Ele('div','sch-wrap'),r=Ele('div','sch-wrap');r.style.whiteSpace='nowrap',i.append(s,r);let d=Ele('div','st-list').icon('list'),c=Ele('div','st-table').icon('table');d.onclick=()=>{s.show(),d.addCls('on'),r.hide(),c.rmCls('on')},c.onclick=()=>{s.hide(),d.rmCls('on'),r.show(),c.addCls('on')},i.firstChild.append(d,c),d.click();const h={'Solo Run':'s0','Special Event':'s1','Blind Race':'s2','Standard Race':'s3','Q&A':'s4'};let o=new Date(0),p=0,g=null,v=null,f=1440,b=0;e.forEach(e=>{let t=e.get('s'),i=60*t.getHours()+t.getMinutes()+t.getSeconds()/60;i<f&&(f=i)}),f-=5,e.forEach(e=>{let i=e.get('s');i.getDate()!==o.getDate()&&(p++,o=new Date(t.fDate(i)+' 00:00:00'),g=Ele('div','sch'),g.innerHTML=`<div class='sch-day'>Day ${p}</div><div class='sch-date'>${t.fDate(i)} ${t.week[i.getDay()]}</div>`,s.append(g),v=Ele('div','table-day'),v.innerHTML=`<h5>Day ${p}<p>${i.getMonth()+1}.${i.getDate()} ${t.week[i.getDay()]}</p></h5>`,r.append(v),v.onwheel=e=>{let t=m-e.deltaY;t>=1e3&&(m=t,css(y,{height:t+'px'})),e.preventDefault()});let a=Ele('div','sch-r'),l=Ele('div','table-run '+(h[e.get('t')||'Solo Run']||'s5')),n=`<div class='sch-time'>${t.fTime(i)}</div><div class='sch-game'>`,d=`<div class='table-time'>${t.fTime(i)}<span> - ${t.fMin(e.get('e'))}</span></div>`;e.get('v')&&(n+=`<a class='sch-video' href='https://www.bilibili.com/video/${e.get('v')}' target='_blank'><svg><use href='#-bili'></use></svg></a>`),e.get('g').forEach((e,t)=>{t&&(n+=', ');let i=e.lastIndexOf('=');if(-1===i)n+=`<a>${e}</a>`,d+=`<a class='table-game'>${e}</a>`;else{let t=e.slice(i+1);'h'!==t[0]&&(t='https://delicious-fruit.com/ratings/game_details.php?id='+t),n+=`<a href='${t}' target='_blank'>${e.slice(0,i)}</a>`,d+=`<a class='table-game' href='${t}' target='_blank'>${e.slice(0,i)}</a>`}}),n+=`</div><span class='sch-est'>${t.fMin(e.get('e'))}</span><span class='sch-cat'>${e.get('c')||'Any%'}</span><span class='sch-type'>${e.get('t')||'Solo Run'}</span><div class='sch-runner'>`,d+=`<div style='margin:8px;white-space:pre-line'>${e.get('c')||'Any%'} by `,e.get('r').forEach((e,t)=>{'&'===e[0]?(e=e.slice(1),n+='&'):t&&(n+=', ');let i,a=e.lastIndexOf('>');-1===a?(a=e.lastIndexOf('/'),-1===a?(a=e.lastIndexOf(':'),-1!==a&&(i='https://www.twitch.tv/'+e.slice(a+1))):i='https://space.bilibili.com'+e.slice(a)):i=e.slice(a+1),i?(i=`<a href='${i}' target='_blank'>${e.slice(0,a)}</a>`,n+=i,d+=i,RUNNER.add(e.slice(0,a).replace(/\(.*\)/g,'').toLowerCase())):(i=`<a>${e}</a>`,n+=i,d+=i,RUNNER.add(e.replace(/\(.*\)/g,'').toLowerCase()))}),a.innerHTML=n+'</div>',g.append(a);let c=(i-o)/6e4-f,x=e.get('e');l.top=c,l.height=x,c+x>b&&(b=c+x),l.innerHTML=d+'</div>',v.append(l)}),g=Ele('div','sch'),g.innerHTML="<div class='sch-day'>End</div>",s.append(g);let y=c$('table-day'),m=2e3;css(y,{width:`calc(${100/p}% - 10px)`,height:'3000px'});let x=c$('table-run');for(let e=x.length;e--;)css(x[e],{top:x[e].top/b*100+'%',height:x[e].height/b*100+'%'})});const G=e=>{let t=Ele('div','review'),i=Ele('div').text(e.get('user').getUsername()),a=e.createdAt;return i.append(Ele('div','rv-time').text(FASF.Time.fDate(a)+' '+FASF.Time.fTime(a))),t.append(i,Ele('p').text(e.get('word'))),t};i$('review').onclick=function(){if(this.on)return;if(!FASF.user)return alert(_t('请先登录哦'));let e=this.prev().value.trim();if(!e)return;this.on=!0,this.r=function(){this.on=!1,css(this,{background:'',pointerEvents:''})};let t=FASF.DB.Object('Review');t.set('user',FASF.user),t.set('word',e),t.set('index',data.year),t.save().then(e=>{let t=G(e),i=i$('rv-box').lastChild.prev(),a=i.prev();a.firstChild?(i.firstChild.before(t),a.firstChild.before(t.cloneNode(1))):(i.append(t),a.append(t.cloneNode(1))),this.r(),this.prev().value=''},e=>{alert(_t('发表失败')),this.r()}),css(this,{background:'#bcd',pointerEvents:'none'})},FASF.DB.Query('Review').equalTo('index',data.year).include('user.username').descending('createdAt').find().then(e=>{if(0===e.length)return;let t=i$('rv-box').lastChild,i=t.prev(),a=i.prev(),l=0,n=0;e.forEach(e=>{let s=G(e);l<=n?(i.append(s),l+=s.offsetHeight+24):(t.append(s),n+=s.offsetHeight+24),a.append(s.cloneNode(1))})});